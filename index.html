<!DOCTYPE html>
<html>
  <head>
    <title>Champion de calcul mental</title>
    <style type="text/css">
      .success {
        background: green;
      }
      .failure {
        background: orange;
      }
      #score-table table {
        border-collapse:collapse;
      }
      #score-table table td {
        border:1px solid black;
      }

    </style>
  </head>
  <body>
    <div id="app">
      <div id="difficulty-screen">
        <h1>Difficult√©</h1>
        <button onclick="startGame('easy')">1..5 + 1..5</button>
        <button onclick="startGame('medium')">1..5 + 6..10</button>
        <button onclick="startGame('difficult')">6..10 + 6..10</button>
      </div>
      <div id="game-screen" style="display: none;">
        <h1>Champion de calcul mental</h1>

        <div id="problem">
          <!-- Problem will be displayed here -->
        </div>
        <button id="check-btn" onclick="checkAnswer()">Check Answer</button>

        <button id="success-btn" onclick="showResult('success')">Success</button>
        <button id="failure-btn" onclick="showResult('failure')">Failure</button>
      </div>
      <div id="result-screen" style="display: none;">
        <h1>Game Over</h1>
        <p>Successes: <span id="success-count">0</span></p>
        <p>Failures: <span id="failure-count">0</span></p>
      </div>
      <div id="score-table">
      </div>
    </div>
    <script>
      let currentDifficulty;
      let pairs = [];
      let success_pairs = [];
      let failure_pairs = [];
      let currentPairIndex = 0;
      let successes = 0;
      let failures = 0;
      let displayAnswer = false;
      let mini = 1, maxi = 2;
      let minj = 1, maxj = 2;

      function startGame(difficulty) {
        currentDifficulty = difficulty;
        displayAnswer = false;
        pairs = generatePairs(difficulty);
        showGameScreen();
        update_display_result();
        displayNextPair();
        createResultTable();
      }

      function generatePairs(difficulty) {
        const pairs = [];
        if(difficulty == 'medium') {
          minj = 6;
          maxj = 10;
        }
        if(difficulty == 'difficult') {
          mini = 6;
          maxi = 10;
          minj = 6;
          maxj = 10;
        }
        
        for (let i = mini; i <= maxi; i++) {
          for (let j = minj; j <= maxj; j++) {
            pairs.push({ i, j });
          }
        }

        return pairs;
      }

      function showGameScreen() {
        document.getElementById("difficulty-screen").style.display = "none";
        document.getElementById("game-screen").style.display = "block";
      }

      function displayNextPair() {
        createResultTable();
        if (currentPairIndex < pairs.length) {
          const pair = pairs[currentPairIndex];
          document.getElementById("problem").innerText = `${pair.i} + ${pair.j} = ?`;
        } else {
          showResultScreen();
        }
      }

      function checkAnswer() {
        displayAnswer = true;
        update_display_result();
      }

      function showResult(result) {
        const pair = pairs[currentPairIndex];

        if (result === "success") {
          successes++;
          success_pairs.push([pair.i, pair.j])
        } else if (result === "failure") {
          failures++;
          failure_pairs.push([pair.i, pair.j])
        }
        currentPairIndex++;
        displayAnswer = false;
        displayNextPair();
        update_display_result();
      }

      function update_display_result(){
        const pair = pairs[currentPairIndex];
        if(displayAnswer){
          document.getElementById("check-btn").style.display = "none";
          document.getElementById("success-btn").style.display = "inline";
          document.getElementById("failure-btn").style.display = "inline";
          let result = pair.i + pair.j;
          document.getElementById("problem").innerText = `${pair.i} + ${pair.j} = ${result}`;
        } else {
          document.getElementById("check-btn").style.display = "inline";
          document.getElementById("success-btn").style.display = "none";
          document.getElementById("failure-btn").style.display = "none";
          document.getElementById("problem").innerText = `${pair.i} + ${pair.j} = ?`;
        }
        createResultTable();
      }

      function showResultScreen() {
        document.getElementById("game-screen").style.display = "none";
        document.getElementById("result-screen").style.display = "inline";
        document.getElementById("success-count").innerText = successes;
        document.getElementById("failure-count").innerText = failures;
      }

      function createResultTable() {
            const table = document.getElementById("score-table");
            let tableHTML = "<table>";

            for (let i = mini; i <= maxi; i++) {
                tableHTML += "<tr>";
                for (let j = minj; j <= maxj; j++) {
                    if(isPairInArray(success_pairs, [i, j])){
                      tableHTML += "<td class='success'>" + i + "+" + j + "</td>";
                    } else if(isPairInArray(failure_pairs, [i, j])){
                      tableHTML += "<td class='failure'>" + i + "+" + j + "</td>";
                    } else {
                      tableHTML += "<td>" + i + "+" + j + "</td>";
                    }
                }
                tableHTML += "</tr>";
            }

            tableHTML += "</table>";
            table.innerHTML = tableHTML;
        }

        function isPairInArray(pairsArray, pairToCheck) {
            for (const pair of pairsArray) {
                if (pair[0] === pairToCheck[0] && pair[1] === pairToCheck[1]) {
                    return true;
                }
            }
            return false;
        }
    </script>
  </body>
</html>
